services:
  rustic-twingo-encoder-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: rustic-twingo-encoder:dev
    container_name: rustic-twingo-encoder-dev
    ports:
      - "3000:3000"
    volumes:
      # Hot-reload: mount source code
      - ./app:/app/app
      - ./bash:/app/bash
      - ./config:/app/config
      - ./public:/app/public
      - ./package.json:/app/package.json
      - ./next.config.mjs:/app/next.config.mjs
      - ./postcss.config.mjs:/app/postcss.config.mjs
      - ./jsconfig.json:/app/jsconfig.json
      # Prevent overwriting node_modules and .next from host
      - /app/node_modules
      - /app/.next
      # Mount music directories
      - /home/yodak025/Music:/music:ro
      - /home/yodak025/Music/outputs:/outputs:rw
    environment:
      - NODE_ENV=development
    # User mapping for correct file permissions
    user: "1000:1000"
    # Keep container running for development
    stdin_open: true
    tty: true
    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
